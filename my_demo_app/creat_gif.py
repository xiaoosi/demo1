# coding:utf-8import moviepy.editor as mpyimport osdef create_text_clip(string, b_time=0, e_time=0):    text_clip = mpy.TextClip(string, font=r"Noto-Sans-CJK-JP-Bold",                             fontsize=20, color="#fff").set_pos((10,10))    text_clip = text_clip.set_start(b_time).set_end(e_time)    return text_clipdef create_text_clip_use_patchs(patchs, file_path):    clips = []    wh = [0, 0]    for patch in patchs:        clip = create_text_clip(patch['text'], patch['st_time']*0.2, patch['en_time']*0.2)        if clip.size[0] > wh[0]: wh[0] = clip.size[0]        if clip.size[1] > wh[1]: wh[1] = clip.size[1]        clips.append(clip)    text_clip = mpy.CompositeVideoClip(clips, size=wh)    videoclip = mpy.VideoFileClip(os.path.join(file_path, "gif.gif"))    new_clip = mpy.CompositeVideoClip([videoclip, text_clip.set_position("bottom")])    print os.path.join(file_path, "out.gif")    new_clip.write_gif(os.path.join(file_path, "out.gif"))    returndef division(file_path):    clip = mpy.VideoFileClip(os.path.join(file_path, "gif.gif"))    for i in range(int(clip.duration / 0.2)):        # print os.path.join(file_path, "patch", "{}.jpg".format(i))        clip.save_frame(os.path.join(file_path, "patch", "{}.jpg".format(i)), i*0.2)    return clip.duration / 0.2if __name__ == '__main__':    text_patch = {"text": "我肖雨林",                  "st_time": 0,                  "en_time": 2}    text_patch1 = {"text": "就是烦死，死外边，从这跳下去",                   "st_time": 1,                   "en_time": 5}    text_patch2 = {"text": "也不会玩DNF这种辣鸡游戏",                   "st_time": 4,                   "en_time": 5}    text_patch3 = {"text": "真好玩",                   "st_time": 5,                   "en_time": 6.5}    patchs = []    patchs.append(text_patch)    patchs.append(text_patch1)    patchs.append(text_patch2)    patchs.append(text_patch3)    create_text_clip_use_patchs(patchs, 'gif')    # text_clip = creat_text_clip_use_patchs(patchs)    # clip = mpy.VideoFileClip("gif/wjz.gif")    # text_clip = creat_text_clip("吃屎", e_time=clip.end)    # text_clip = mpy.TextClip("吃屎", font=r"Noto-Sans-CJK-JP-Bold", fontsize=20, color="#fff")    # text_clip2 = mpy.TextClip("吃屎粑粑", font=r"Noto-Sans-CJK-JP-Bold", fontsize=20, color="#fff")    # text_clip = text_clip.set_duration(clip.duration/2)    # text_clip2 = text_clip2.set_duration(clip.duration/2)    # text_clip = mpy.concatenate_videoclips([text_clip, text_clip2])    # new_clip = mpy.CompositeVideoClip([clip, text_clip.set_position("bottom")])    # new_new_clip = new_clip.fx(mpy.vfx.speedx, 0.5)    # new_clip.write_gif("gif/test1.gif")    # for i in range(int(clip.duration / 0.3)):    #     clip.save_frame("patch/%d.jpg" % i, i * 0.3)